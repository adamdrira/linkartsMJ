

<div class="chapters-controller" [formGroup]="form" >

    <div class="chapters-title">
        <span>Liste des chapitres</span>
        <div class="add-chapter-button" (click)="add_series_chapter();">
            <div class="plus-icon"></div>
            <span>Ajouter</span>
        </div>
    </div>


    <div class="chapters-list" formArrayName="chapters" *ngIf="form_number==0">
        <ng-container *ngFor="let element of componentRef; let i = index" class="test">
            <div class="chapter" [ngClass]="{ 'selected' : i==current_chapter }" >
                <div class="chapter-validated">
                    <div *ngIf="element.chapterValidated" class="validated-icon">
                    </div>
                </div>
                <div class="chapter-number" (click)="open_chapter(i);">
                    <span>Chapitre {{element.chapter + 1}}</span>
                </div>
                <div class="chapter-name">
                    <!--<span *ngIf="edit_name!=i"> {{element.name}} </span>-->
                    <mat-form-field class="mat-input disabled" *ngIf="edit_name!=i">
                        <mat-label>Nom du chapitre</mat-label>
                        
                        <input matInput disabled
                        type="text" [value]=element.name autocomplete="off" 
                        *ngIf="edit_name!=i"/>
                    </mat-form-field>

                    <mat-form-field class="mat-input" *ngIf="edit_name==i" >
                        <mat-label>Nom du chapitre</mat-label>
                        <input #changeName matInput
                        type="text" value=element.name autocomplete="off" 
                        *ngIf="edit_name==i" 
                        (keyup.enter)="validate_name(i);"
                        [formControlName]="i"
                        />
                    </mat-form-field>

                    <button class="button-name" (click)="validate_name(i);" *ngIf="edit_name==i">
                        <div class="validate-icon"></div>
                    </button>
                </div>

                <div class="chapter-icons">
                    <div class="button" *ngIf="edit_name==i" (click)="cancel_add_chapter(i);">
                        <div class="delete-icon"></div>
                    </div>
                    <button class="button" (click)="set_edit_name(i,'modify');" *ngIf="edit_name==-1">
                        <div class="modify-icon"></div>
                    </button>
                    <button class="button" (click)="openDeleteDialog(i);" *ngIf="edit_name==-1">
                        <div class="delete-icon"></div>
                    </button>
                </div>

            </div>

        </ng-container>
    </div>


    <div class="chapters-list" formArrayName="chapters" *ngIf="form_number==1 && display_chapters">
        <ng-container *ngFor="let element of list_of_chapters; let i = index" class="test">
            <div class="chapter" >
                <div class="chapter-validated">
                    <div *ngIf="list_of_chapters_validated[i]" class="validated-icon">
                    </div>
                </div>
                <div class="chapter-number" (click)="open_chapter(i);">
                    <span>Chapitre {{element.chapter_number}}</span>
                </div>
                <div class="chapter-name">
                    <mat-form-field class="mat-input disabled" *ngIf="edit_name!=i">
                        <mat-label>Nom du chapitre</mat-label>
                        
                        <input matInput disabled
                        type="text" [value]=element.title autocomplete="off"/>
                    </mat-form-field>

                    <mat-form-field class="mat-input" *ngIf="edit_name==i" >
                        <mat-label>Nom du chapitre</mat-label>
                        <input #changeName matInput
                        type="text" value=element.title autocomplete="off" 
                        (keyup.enter)="validate_name(i);"
                        [formControlName]="i"
                        />
                    </mat-form-field>

                    <button class="button-name" (click)="validate_name(i);" *ngIf="edit_name==i">
                        <div class="validate-icon"></div>
                    </button>
                </div>

                <div class="chapter-icons">
                    <div class="button" *ngIf="edit_name==i" (click)="cancel_add_chapter(i);">
                        <div class="delete-icon"></div>
                    </div>
                    <button class="button" (click)="set_edit_name(i,'modify');" *ngIf="edit_name==-1">
                        <div class="modify-icon"></div>
                    </button>
                    <button  class="button" (click)="openDeleteDialog(i);" *ngIf="edit_name==-1 && i==list_of_chapters.length-1">
                        <div class="delete-icon"></div>
                    </button>
                </div>

            </div>

        </ng-container>
    </div>

</div>



<div class="pages-controller" *ngIf="form_number==0">

    <ng-container *ngFor="let element of componentRef; let i = index" class="test">
        <app-swiper-upload-serie *ngIf=element.swiperInitialized type="Série" [chapter]="i" (validated)="validated_chapter(i);" [hidden]="current_chapter!=i"></app-swiper-upload-serie>
    </ng-container>
    

</div>

<div class="pages-controller" *ngIf="form_number==1 && chapter_creation_in_progress">

    <ng-container  class="test">
        <app-swiper-upload-serie type="Série" [chapter]="current_chapter" (validated)="validated_chapter(current_chapter);"></app-swiper-upload-serie>
    </ng-container>
    

</div>



<button mat-raised-button class="submit-button style1" (click)="validateAll();">
    <span>Tout valider</span>
</button>


<div id="upload-global-serie-error" class="modal">
    <p></p>
    <div><a rel="modal:close">Continuer</a></div>
</div>